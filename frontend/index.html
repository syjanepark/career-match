<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CareerMatch ‚ú®</title>
    <link rel="stylesheet" href="./dist/output.css" />
  </head>
  <body class="bg-[#f4f9ff] text-[#111518]">
    <div class="max-w-3xl mx-auto py-10 px-4">
      <header class="mb-8 text-center">
        <h1 class="text-3xl font-extrabold text-[#7db9e8]">CareerMatch ‚ú®</h1>
        <p class="text-sm mt-1 text-[#555]">Discover suitable jobs based on your personality!</p>
      </header>

      <form id="quizForm" class="space-y-8">
        <!-- Question Block -->
        <div>
          <h3 class="text-base font-semibold mb-3">üí¨ Describe your personality</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="quiz-choice">Outgoing and sociable
              <input type="radio" name="personality" value="Outgoing and sociable" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Reserved and thoughtful
              <input type="radio" name="personality" value="Reserved and thoughtful" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Creative and imaginative
              <input type="radio" name="personality" value="Creative and imaginative" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Practical and organized
              <input type="radio" name="personality" value="Practical and organized" class="sr-only peer" hidden />
            </label>
          </div>
        </div>
        
        <div>
          <h3 class="text-base font-semibold mb-3">üìÖ Describe your ideal weekend</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="quiz-choice">Exploring new places and activities
              <input type="radio" name="weekend" value="Exploring new places and activities" class="sr-only peer"  hidden />
            </label>
            <label class="quiz-choice">Relaxing at home with hobbies
              <input type="radio" name="weekend" value="Relaxing at home with hobbies" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Spending time with friends and family
              <input type="radio" name="weekend" value="
              Spending time with friends and family" class="sr-only peer"  hidden />
            </label>
            <label class="quiz-choice">Working on personal projects
              <input type="radio" name="weekend" value="Working on personal projects" class="sr-only peer" hidden />
            </label>
          </div>
        </div>

        <div>
          <h3 class="text-base font-semibold mb-3"> üîç How do you typically approach solving problems?</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="quiz-choice"> 
              Analytical and detail-oriented
              <input type="radio" name="solving" value="Analytical and detail-oriented" class="sr-only peer"  hidden />
            </label>
            <label class="quiz-choice">Collaborative and brainstorming-focused
              <input type="radio" name="solving" value="Collaborative and brainstorming-focuseds" class="sr-only peer"  hidden />
            </label>
            <label class="quiz-choice">Intuitive and creative
              <input type="radio" name="solving" value="
              Intuitive and creative" class="sr-only peer"  class="sr-only peer"  hidden />
            </label>
            <label class="quiz-choice">Practical and hands-on
              <input type="radio" name="solving" value="Practical and hands-on" class="sr-only peer" hidden />
            </label>
          </div>
        </div>

        <div>
          <h3 class="text-base font-semibold mb-3"> üíª What kind of work environment helps you do your best?</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="quiz-choice"> 
              Structured and organized
              <input type="radio" name="environment" value="Structured and organizedd" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Flexible and adaptable
              <input type="radio" name="environment" value="Flexible and adaptable" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice"> Collaborative and team-oriented
              <input type="radio" name="environment" value="
              Collaborative and team-oriented" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Independent and self-directed
              <input type="radio" name="environment" value="Independent and self-directed" class="sr-only peer" hidden />
            </label>
          </div>
        </div>

        <div>
          <h3 class="text-base font-semibold mb-3"> ü§º How do you like to work with others?</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="quiz-choice"> 
              As a leader, taking charge
              <input type="radio" name="role" value="As a leader, taking charge" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">As a team player, contributing ideas
              <input type="radio" name="role" value="As a team player, contributing ideas" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice"> Independently, with minimal interaction
              <input type="radio" name="role" value="
              Independently, with minimal interaction" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Collaboratively, sharing responsibilities
              <input type="radio" name="role" value="Collaboratively, sharing responsibilities" class="sr-only peer" hidden />
            </label>
          </div>
        </div>

        <div>
          <h3 class="text-base font-semibold mb-3"> üéØ What motivates you most at work?</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="quiz-choice"> 
              Achieving goals and recognition
              <input type="radio" name="motivates" value="
              Achieving goals and recognition" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Making a positive impact
              <input type="radio" name="motivates" value="Making a positive impact" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice"> Learning and personal growth
              <input type="radio" name="motivates" value="
              Learning and personal growth" class="sr-only peer" hidden />
            </label>
            <label class="quiz-choice">Financial rewards and stability
              <input type="radio" name="motivates" value="Financial rewards and stability" class="sr-only peer" hidden />
            </label>
          </div>
        </div>

        <div class="text-center">
          <button
            type="submit"
            class="px-6 py-2 rounded-full bg-[#cce7ff] text-[#111518] font-semibold shadow hover:bg-[#b6dcfa] transition"
          >
             Find My Match ‚ú®
          </button>
        </div>
      </form>
    </div>

    <script src="./config.js"></script>
    <script>
      // Configuration
      const API_BASE_URL = "https://career-match-0pw6.onrender.com";
      const STORAGE_KEY = "careerMatchData";
      
      // UI Setup
      const choices = document.querySelectorAll('.quiz-choice');
      choices.forEach((label) => {
        // Add base classes
        label.classList.add('border', 'rounded-xl', 'py-2', 'px-4', 'cursor-pointer', 'text-sm', 'transition');
        
        // Add click handler
        label.addEventListener('click', () => {
          const input = label.querySelector('input');
          const name = input.name;
          
          // Remove selected state from all options in this group
          document.querySelectorAll(`input[name="${name}"]`).forEach((el) => {
            el.parentElement.classList.remove('selected');
          });
          
          // Add selected state to clicked option
          label.classList.add('selected');
          input.checked = true;
          
          console.log(`Selected ${name}: ${input.value}`);
        });
      });

      // API Helper Functions
      async function testBackendConnection() {
        try {
          const response = await fetch(`${API_BASE_URL}/`);
          return response.ok;
        } catch (error) {
          console.error('Backend connection test failed:', error);
          return false;
        }
      }

      async function submitCareerMatch(payload) {
        try {
          const response = await fetch(`${API_BASE_URL}/match`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload),
            timeout: 30000
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          return await response.json();
        } catch (error) {
          console.error('API Request failed:', error);
          throw error;
        }
      }

      // Form Submission Handler
      document.getElementById('quizForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        console.log("Form submitted!");

        // Get form data
        const getValue = (name) =>
          document.querySelector(`input[name="${name}"]:checked`)?.value;

        const payload = {
          personality: getValue("personality"),
          weekend: getValue("weekend"),
          solving: getValue("solving"),
          environment: getValue("environment"),
          role: getValue("role"),
          motivates: getValue("motivates")
        };

        console.log("Payload:", payload);

        // Validate all questions are answered
        const allAnswered = Object.values(payload).every(
          (value) => value !== undefined && value.trim() !== ""
        );
        
        if (!allAnswered) {
          alert("Please answer all questions before submitting.");
          return;
        }

        // Show loading state
        const submitButton = e.target.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        submitButton.textContent = "Processing... ‚ú®";
        submitButton.disabled = true;

        try {
          console.log("Submitting to backend:", payload);
          
          // Submit the form directly without connection test first
          const result = await submitCareerMatch(payload);
          console.log("Backend response:", result);
          
          // Store result and redirect
          localStorage.setItem(STORAGE_KEY, JSON.stringify(result));
          console.log("Data stored, redirecting to result page...");
          window.location.href = "./result.html";
          
        } catch (error) {
          console.error("Error:", error);
          alert(`An error occurred: ${error.message}. Please try again.`);
        } finally {
          // Restore button state
          submitButton.textContent = originalText;
          submitButton.disabled = false;
        }
      });

      // Test backend connection on page load
      window.addEventListener('load', async () => {
        const isConnected = await testBackendConnection();
        if (!isConnected) {
          console.warn('Backend connection test failed on page load');
        }
      });
    </script>
  </body>
</html>